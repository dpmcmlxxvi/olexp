!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).olexp=e()}(this,function(){"use strict";const t={measure:{}};!function(t){t.measure.properties={area:"olexp-measure-property-area",length:"olexp-measure-property-length"};var e=function(t){ol.Overlay.call(this,t)};e.prototype=Object.create(ol.Overlay.prototype);var o=function(t,e,o){var i=$.extend(!0,{measure:{Tool:{continueLineMsg:"Click to continue drawing the line",continuePolygonMsg:"Click to continue drawing the polygon",helpTooltipOffset:[20,0],helpTooltipPositioning:"center-left",measuredStyle:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),measuringStyle:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})}),measureTooltipOffset:[0,-20],measureTooltipPositioning:"bottom-center",messageStart:"Click to start drawing. Double click to stop."}}},o);this.settings=i.measure.Tool,this.continueLineMsg=this.settings.continueLineMsg,this.continuePolygonMsg=this.settings.continuePolygonMsg,this.count=0,this.draw=null,this.drawing=!1,this.geodesic=!1,this.helpTooltip=null,this.helpTooltipElement=null,this.map=t,this.measureTooltip=null,this.measureTooltipElement=null,this.pointerMoveCallback=this.onPointerMove.bind(this),this.sketch=null,this.source=null,this.sphere=new ol.Sphere(6378137),this.type=e,this.vector=null};o.prototype.createHelpTooltip=function(){this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement("div"),this.helpTooltipElement.className="olexp-measure olexp-measure-hidden",this.helpTooltip=new t.measure.Overlay({element:this.helpTooltipElement,offset:this.settings.helpTooltipOffset,positioning:this.settings.helpTooltipPositioning}),this.map.addOverlay(this.helpTooltip)},o.prototype.createMeasureVector=function(){this.vector=new ol.layer.Vector({source:this.source,style:this.settings.measuredStyle}),this.vector.set("name","Measurement #"+(this.count+1)),this.map.addLayer(this.vector)},o.prototype.createMeasureTooltip=function(){this.measureTooltipElement&&this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement),this.measureTooltipElement=document.createElement("div"),this.measureTooltipElement.className="olexp-measure olexp-measure-active",this.measureTooltip=new t.measure.Overlay({element:this.measureTooltipElement,offset:this.settings.measureTooltipOffset,positioning:this.settings.measureTooltipPositioning}),this.measureTooltip.set("name","Measurement #"+(this.count+1)),this.map.addOverlay(this.measureTooltip)},o.prototype.formatArea=function(t){var e=0;if(this.geodesic){var o=this.map.getView().getProjection(),i=t.clone().transform(o,"EPSG:4326").getLinearRing(0).getCoordinates();e=Math.abs(this.sphere.geodesicArea(i))}else e=t.getArea();return e>1e4?Math.round(e/1e6*100)/100+" km<sup>2</sup>":Math.round(100*e)/100+" m<sup>2</sup>"},o.prototype.formatLength=function(t){var e=0;if(this.geodesic){var o=0,i=0,n=0,r=this.map.getView().getProjection(),s=t.getCoordinates(),a=s.length;for(o=0;o<a-1;o+=1)i=ol.proj.transform(s[o],r,"EPSG:4326"),n=ol.proj.transform(s[o+1],r,"EPSG:4326"),e+=this.sphere.haversineDistance(i,n)}else e=Math.round(100*t.getLength())/100;return e>100?Math.round(e/1e3*100)/100+" km":Math.round(100*e)/100+" m"},o.prototype.onPointerMove=function(t){if(!t.dragging){var e=this.settings.messageStart;if(this.sketch){var o=this.sketch.getGeometry();o instanceof ol.geom.Polygon?e=this.continuePolygonMsg:o instanceof ol.geom.LineString&&(e=this.continueLineMsg)}this.helpTooltipElement.innerHTML=e,this.helpTooltip.setPosition(t.coordinate),$(this.helpTooltipElement).removeClass("olexp-measure-hidden")}},o.prototype.setEnable=function(t){t?this.map.on("pointermove",this.pointerMoveCallback):this.map.un("pointermove",this.pointerMoveCallback),this.setInteraction(t)},o.prototype.setInteraction=function(e){void 0===e&&(e=!0);var o=this;if(this.draw&&this.map.removeInteraction(this.draw),!e)return $(this.helpTooltipElement).addClass("olexp-measure-hidden"),void(this.drawing&&(this.map.removeLayer(this.vector),this.vector=null,this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement),this.measureTooltipElement=null,this.drawing=!1));$(this.helpTooltipElement).removeClass("olexp-measure-hidden"),this.source=new ol.source.Vector,this.draw=new ol.interaction.Draw({source:this.source,type:this.type,style:this.settings.measuringStyle}),this.map.addInteraction(this.draw),this.createMeasureTooltip(),this.createHelpTooltip();var i=null;this.draw.on("drawstart",function(t){this.drawing=!0,o.createMeasureVector();var e=t.coordinate;o.sketch=t.feature,i=o.sketch.getGeometry().on("change",function(t){var i="",n=t.target;n instanceof ol.geom.Polygon?(i=o.formatArea(n),e=n.getInteriorPoint().getCoordinates()):n instanceof ol.geom.LineString&&(i=o.formatLength(n),e=n.getLastCoordinate()),o.measureTooltipElement.innerHTML=i,o.measureTooltip.setPosition(e)})},this),this.draw.on("drawend",function(){this.drawing=!1,o.count+=1;var e=o.sketch.getGeometry(),n={};e instanceof ol.geom.Polygon?(n[t.measure.properties.area]=o.formatArea(e),o.vector.setProperties(n)):e instanceof ol.geom.LineString&&(n[t.measure.properties.length]=o.formatLength(e),o.vector.setProperties(n)),o.sketch=null,o.measureTooltipElement.parentNode.removeChild(o.measureTooltipElement),o.measureTooltipElement=null,o.createMeasureTooltip(),ol.Observable.unByKey(i),o.setInteraction(!0)},this)},o.prototype.setType=function(t){this.type=t},t.measure.Tool=function(e,i){void 0===i&&(i={}),void 0===i.type&&(i.type=t.measure.Type.LINE),void 0===i.settings&&(i.settings={});var n=new o(e,i.type,i.settings);return{setEnable:function(t){n.setEnable(t)},setType:function(t){n.setType(t)}}},t.measure.Type={AREA:"Polygon",LINE:"LineString"},t.measure.Overlay=e}(t||{});var e=t.measure;const o={ol:{}};!function(t){var e=function(t,e){var o=$.extend(!0,{ol:{ToolbarShow:{html:"T",title:"Show toolbar"}}},e);this.settings=o.ol.ToolbarShow,this.explorer=t;var i=document.createElement("button");i.innerHTML=this.settings.html,i.title=this.settings.title,i.addEventListener("click",this.show.bind(this),!1),i.addEventListener("touchstart",this.show.bind(this),!1);var n=document.createElement("div");n.id=e.prefix+"-ol-toolbar-show",n.className="olexp-ol-toolbar-show ol-unselectable ol-control",n.appendChild(i),ol.control.Control.call(this,{element:n})};ol.inherits(e,ol.control.Control),e.prototype.show=function(){this.explorer.layout.show(this.explorer.options.toolbar.type),this.setMap(null)},t.ol.ToolbarShow=function(t,o){var i=$.extend({hidden:!1},o),n=new e(t,i.settings);return i.hidden&&n.setMap(t.map),n}}(o||{});var i=o.ol;const n={util:{}};!function(t){var e=function(t){var e=$.extend(!0,{util:{Util:{Cluster:function(t){return[new ol.style.Style({image:new ol.style.Circle({radius:10,stroke:new ol.style.Stroke({color:"#ffffff"}),fill:new ol.style.Fill({color:"#3399CC"})}),text:new ol.style.Text({text:t.toString(),fill:new ol.style.Fill({color:"#ffffff"})})})]},Point:[new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"rgba(255,255,0,0.5)"}),radius:5,stroke:new ol.style.Stroke({color:"#ff0",width:1})})})],LineString:[new ol.style.Style({stroke:new ol.style.Stroke({color:"#f00",width:3})})],Polygon:[new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0,255,255,0.5)"}),stroke:new ol.style.Stroke({color:"#0ff",width:1})})],MultiPoint:[new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"rgba(255,0,255,0.5)"}),radius:5,stroke:new ol.style.Stroke({color:"#f0f",width:1})})})],MultiLineString:[new ol.style.Style({stroke:new ol.style.Stroke({color:"#0f0",width:3})})],MultiPolygon:[new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0,0,255,0.5)"}),stroke:new ol.style.Stroke({color:"#00f",width:1})})]}}},t);this.settings=e.util.Util,this.defaultStyle={Point:this.settings.Point,LineString:this.settings.LineString,Polygon:this.settings.Polygon,MultiPoint:this.settings.MultiPoint,MultiLineString:this.settings.MultiLineString,MultiPolygon:this.settings.MultiPolygon},this.clusterStyleCache={}};e.prototype.addLayerVector=function(t,e,o,i){void 0===i&&(i=!0);var n=this;o.forEach(function(t){if(!1!==i){var e=t.getGeometry();void 0!==e&&"Point"===e.getType()||(i=!1)}});var r=new ol.source.Vector({features:o});i&&(r=new ol.source.Cluster({source:r}));var s=function(t,e){var o=t.getStyleFunction();return o?o.call(t,e):n.defaultStyle[t.getGeometry().getType()]};i&&(s=function(t){return n.getClusterStyle(t)});var a=new ol.layer.Vector({source:r,style:s});a.set("name",e),t.getLayers().push(a)},e.prototype.getClusterStyle=function(t){var e=t.get("features").length,o=this.clusterStyleCache[e];return o||(o=this.settings.Cluster(e),this.clusterStyleCache[e]=o),o},e.prototype.getControls=function(){return{fullscreen:new ol.control.FullScreen,mouseposition:new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(6),projection:"EPSG:4326"}),overviewmap:new ol.control.OverviewMap,rotate:new ol.control.Rotate,scaleline:new ol.control.ScaleLine,zoom:new ol.control.Zoom,zoomslider:new ol.control.ZoomSlider,zoomtoextent:new ol.control.ZoomToExtent}},e.prototype.getDragAndDrop=function(e){var o=this,i=new ol.interaction.DragAndDrop({formatConstructors:$.map(t.util.FileTypes,function(t){return t.format})});return i.on("addfeatures",function(i){var n=t.util.setExtension(i.file.name,"");o.addLayerVector(e,n,i.features)}),i},e.prototype.getGraticule=function(t,e){var o=$.extend($.extend({},e),{color:"#"+e.color}),i=new ol.Graticule({map:t,strokeStyle:new ol.style.Stroke(o)});return i.olexpRecord=$.extend({enable:null!==t},e),i},e.prototype.getInteractions=function(t){return{draganddrop:this.getDragAndDrop(t)}},e.prototype.getTileTypes=function(){var t={};return t.osm={class:ol.source.OSM,name:"OpenStreetMap",settings:{}},t.stamenTerrain={class:ol.source.Stamen,name:"Stamen (Terrain)",settings:{layer:"terrain"}},t.stamenToner={class:ol.source.Stamen,name:"Stamen (Toner)",settings:{layer:"toner"}},t.stamenWater={class:ol.source.Stamen,name:"Stamen (Water Color)",settings:{layer:"watercolor"}},t},t.util.FileTypes={gpx:{extensions:["gpx"],format:ol.format.GPX,name:"GPX"},igc:{extensions:["igc"],format:ol.format.IGC,name:"IGC"},json:{extensions:["json","geojson"],format:ol.format.GeoJSON,name:"GeoJSON"},kml:{extensions:["kml"],format:ol.format.KML,name:"KML"}},t.util.getReader=function(e){var o=e.substring(e.lastIndexOf(".")+1).toLowerCase(),i=null;return Object.keys(t.util.FileTypes).forEach(function(e){if(null===i){var n=t.util.FileTypes[e];n.extensions.forEach(function(t){null===i&&o===t&&(i=new n.format)})}}),i},t.util.indexOf=function(t,e){var o=0,i=t.getLength();for(o=0;o<i;o+=1)if(e===t.item(o))return o;return-1},t.util.popup=function(t,e,o,i){var n=o.name,r=o.record;w2ui.hasOwnProperty(n)&&w2ui[n].destroy(),$().w2form($.extend(o,{actions:{save:function(){if(0===this.validate().length){w2popup.close();var t=w2ui[n].getChanges();e(t)}},reset:function(){var t=w2ui[n];Object.keys(r).forEach(function(e){t.record[e]=r[e]}),t.refresh()}}})),w2popup.open($.extend(i,{body:'<div id="'+t+'"></div>',onOpen:function(e){e.onComplete=function(){$("#w2ui-popup #"+t).w2render(n)}},onToggle:function(t){var e=w2ui[n];$(e.box).hide(),t.onComplete=function(){$(e.box).show(),e.resize()}}}))},t.util.setExtension=function(t,e){var o=t.split(".");return 1===o.length?o[0]:(o.pop(),o.join(".")+e)},t.util.toProperties=function(t){var e=t.getProperties();if(e.hasOwnProperty("features")){var o=e.features;if(o instanceof Array)if(1===o.length)o[0]instanceof ol.Feature&&(e=o[0].getProperties());else{var i=0;o.forEach(function(t){t instanceof ol.Feature&&(i+=1,e["Cluster Size"]=i)})}}return e},t.util.toRecords=function(t){var e=[],o=0;return Object.keys(t).forEach(function(i){var n=t[i];o+=1,e.push({recid:o,property:i,value:n})}),e},t.util.Util=function(t){var o=new e(t);return{addLayerVector:o.addLayerVector.bind(o),getControls:o.getControls.bind(o),getGraticule:o.getGraticule.bind(o),getInteractions:o.getInteractions.bind(o),getTileTypes:o.getTileTypes.bind(o)}}}(n||{});var r=n.util;const s={control:{},measure:e,ol:i,util:r};!function(t){var e=function(t,e){var o=$.extend(!0,{control:{EditSettings:{form:{header:"",style:"border: 0px; background-color: transparent;"},hint:"Edit Controls",popup:{height:380,style:"width: 100%; height: 100%;",title:"Edit Controls",width:225},span:6}}},e);this.settings=o.control.EditSettings,this.button=e.prefix+"-control-edit-settings-button",this.icon="olexp-control-edit-settings",this.id=e.prefix+"-control-edit-settings-form",this.map=t,this.name=e.prefix+"-control-edit-settings-form"};e.prototype.display=function(){var e=this,o=[{html:{caption:"Full Screen",span:this.settings.span},name:"fullscreen",type:"checkbox"},{html:{caption:"Mouse Position",span:this.settings.span},name:"mouseposition",type:"checkbox"},{html:{caption:"Overview Map",span:this.settings.span},name:"overviewmap",type:"checkbox"},{html:{caption:"Rotate",span:this.settings.span},name:"rotate",type:"checkbox"},{html:{caption:"Scale Line",span:this.settings.span},name:"scaleline",type:"checkbox"},{html:{caption:"Zoom",span:this.settings.span},name:"zoom",type:"checkbox"},{html:{caption:"Zoom Slider",span:this.settings.span},name:"zoomslider",type:"checkbox"},{html:{caption:"Zoom To Extent",span:this.settings.span},name:"zoomtoextent",type:"checkbox"}],i={fullscreen:this.isControlActive("fullscreen"),mouseposition:this.isControlActive("mouseposition"),overviewmap:this.isControlActive("overviewmap"),rotate:this.isControlActive("rotate"),scaleline:this.isControlActive("scaleline"),zoom:this.isControlActive("zoom"),zoomslider:this.isControlActive("zoomslider"),zoomtoextent:this.isControlActive("zoomtoextent")},n=$.extend(this.settings.form,{fields:o,name:this.name,record:i}),r=this.settings.popup;t.util.popup(this.id,function(t){Object.keys(t).forEach(function(o){var i=t[o];e.setControl(o,i)})},n,r)},e.prototype.getControl=function(t){var e=this.map.getControls().getArray(),o=null;return e.forEach(function(e){null===o&&("fullscreen"===t&&e instanceof ol.control.FullScreen?o=e:"mouseposition"===t&&e instanceof ol.control.MousePosition?o=e:"overviewmap"===t&&e instanceof ol.control.OverviewMap?o=e:"rotate"===t&&e instanceof ol.control.Rotate?o=e:"scaleline"===t&&e instanceof ol.control.ScaleLine?o=e:"zoom"===t&&e instanceof ol.control.Zoom?o=e:"zoomslider"===t&&e instanceof ol.control.ZoomSlider?o=e:"zoomtoextent"===t&&e instanceof ol.control.ZoomToExtent&&(o=e))}),o},e.prototype.isControlActive=function(t){var e=this.getControl(t);return null!==e&&null!==e.getMap()},e.prototype.setControl=function(t,e){var o=this.getControl(t);if(null!==o){var i=e?this.map:null;o.setMap(i)}},t.control.EditSettings=function(t,o){var i=new e(t.map,o.settings);return{hint:i.settings.hint,id:i.button,img:i.icon,onClick:function(){i.display()},type:"button"}}}(s||{}),function(t){var e=function(t,e){var o=$.extend(!0,{control:{ExportMap:{filename:"map.png",hint:"Export map"}}},e);this.settings=o.control.ExportMap,this.anchor=e.prefix+"-control-export-map-anchor",this.button=e.prefix+"-control-export-map-button",this.filename=this.settings.filename,this.icon="olexp-control-export-map",this.map=t};e.prototype.toImage=function(){var t=this.anchor,e=this.filename;$("body").append('<a id="'+t+'" download="'+e+'"></a>');var o=document.getElementById(t);o.addEventListener("click",function(){this.map.once("postcompose",function(t){o.href=t.context.canvas.toDataURL("image/png")}),this.map.renderSync()}.bind(this),!1),$("#"+t)[0].click(),$("#"+t).remove()},t.control.ExportMap=function(t,o){var i=new e(t.map,o.settings);return{hint:i.settings.hint,id:i.button,img:i.icon,onClick:function(){i.toImage()},type:"button"}}}(s||{}),function(t){var e=function(e,o){var i=$.extend(!0,{control:{Graticule:{enable:!1,form:{header:"",style:"border: 0px; background-color: transparent;"},hint:"Edit Grid Lines",options:{color:"000000",lineDash:[.5,4],width:2},popup:{height:225,style:"border: 0px; background-color: transparent;",title:"Edit Grid Lines",width:300},span:3}}},o);this.settings=i.control.Graticule,this.button=o.prefix+"-control-graticule-button",this.icon="olexp-control-graticule",this.id=o.prefix+"-control-graticule",this.map=e,this.name=o.prefix+"-control-graticule-form",this.util=new t.util.Util(i),this.graticule=this.util.getGraticule(this.settings.enable?this.map:null,$.extend({},this.settings.options))};e.prototype.display=function(){var e=this,o=[{html:{caption:"Enable",span:this.settings.span},name:"enable",required:!0,type:"checkbox"},{html:{caption:"Color",span:this.settings.span},name:"color",options:{silent:!1},required:!0,type:"color"},{html:{caption:"Width",span:this.settings.span},name:"width",options:{arrows:!0,max:4,min:.25,placeholder:"0.25 - 4",silent:!1,step:.25},required:!0,type:"float"}],i=this.graticule.olexpRecord,n=$.extend(this.settings.form,{fields:o,name:this.name,record:i}),r=this.settings.popup;t.util.popup(this.id,function(t){Object.keys(t).forEach(function(e){i[e]=t[e]});var o=$.extend({},i);delete o.enable,e.graticule.setMap(null),e.graticule=e.util.getGraticule(i.enable?e.map:null,o)},n,r)},t.control.Graticule=function(t,o){void 0===o&&(o={}),void 0===o.settings&&(o.settings={});var i=new e(t.map,o.settings);return{hint:i.settings.hint,id:i.button,img:i.icon,onClick:function(){i.display()},type:"button"}}}(s||{}),function(t){var e=function(e,o){var i=$.extend(!0,{control:{LayerControlTile:{form:{header:"",style:"border: 0px; background-color: transparent;"},hint:"Add Tile Layer",popup:{height:165,style:"border: 0px; background-color: transparent;",title:"Add Tile Layer",width:290},span:3},LayerControlVector:{form:{header:"File Types: "+$.map(t.util.FileTypes,function(t){return" "+t.name}),style:"border: 0px; background-color: transparent;"},hint:"Add Vector Layer",popup:{height:195,style:"border: 0px; background-color: transparent;",title:"Add Vector Layer",width:350},span:4}}},o);this.settingsTile=i.control.LayerControlTile,this.settingsVector=i.control.LayerControlVector,this.icons={tile:"olexp-control-layer-control-add-tile",vector:"olexp-control-layer-control-add-vector"},this.buttons={tile:o.prefix+"-control-layer-control-add-tile-button",vector:o.prefix+"-control-layer-control-add-vector-button"},this.ids={tile:o.prefix+"-control-layer-control-add-tile",vector:o.prefix+"-control-layer-control-add-vector"},this.map=e,this.names={tile:o.prefix+"-control-tile-form",vector:o.prefix+"-control-vector-form"},this.util=new t.util.Util(this.map)};e.prototype.tile=function(){var e=this,o=this.util.getTileTypes(),i=$.map(o,function(t){return t.name}),n=[{field:"tile_source",html:{caption:"Source",span:this.settingsTile.span},options:{items:i},required:!0,type:"list"}],r={};r[n[0].field]=null;var s=$.extend(this.settingsTile.form,{fields:n,name:this.names.tile,record:r}),a=this.settingsTile.popup;t.util.popup(this.ids.tile,function(t){Object.keys(t).forEach(function(i){if(i===n[0].field){var r=t[i].id;Object.keys(o).forEach(function(t){if(r===o[t].name){var i=o[t],n=i.class,s=new ol.layer.Tile({source:new n(i.settings)});s.set("name",r),e.map.addLayer(s)}})}})},s,a)},e.prototype.vector=function(){var e=this,o=[{field:"vector_source",html:{caption:"Source",span:this.settingsVector.span},options:{placeholder:"Click to add file",silent:!1},required:!0,type:"file"}],i={};i[o[0].field]=null;var n=$.extend(this.settingsVector.form,{fields:o,name:this.names.vector,record:i}),r=this.settingsVector.popup;t.util.popup(this.ids.vector,function(i){Object.keys(i).forEach(function(n){n===o[0].field&&Object.keys(i[n]).forEach(function(o){var r=i[n][o].content;if(null!=r){var s=i[n][o].name,a=t.util.setExtension(s,""),l=t.util.getReader(s);if(null!==l){var p=atob(r),h={featureProjection:e.map.getView().getProjection()},c=l.readFeatures(p,h);e.util.addLayerVector(e.map,a,c)}else w2alert("Unable to open file "+s,"Error")}})})},n,r)},t.control.LayerControl=function(t,o){void 0===o&&(o={}),void 0===o.tile&&(o.tile=!0),void 0===o.vector&&(o.vector=!0),void 0===o.settings&&(o.settings={});var i=new e(t.map,o.settings),n=[];return o.tile&&n.push({hint:i.settingsTile.hint,id:i.buttons.tile,img:i.icons.tile,onClick:function(){i.tile()},type:"button"}),o.vector&&n.push({hint:i.settingsVector.hint,id:i.buttons.vector,img:i.icons.vector,onClick:function(){i.vector()},type:"button"}),n}}(s||{}),function(t){var e=function(t,e,o){var i=$.extend(!0,{control:{LayerManager:{hintDetailsHide:"Hide details",hintDetailsShow:"Show details",hintMoveDown:"Move item down",hintMoveUp:"Move item up",hintOutlineHide:"Hide outline",hintOutlineShow:"Show outline"}}},o);this.buttons={details:o.prefix+"-control-layer-manager-button-details",down:o.prefix+"-control-layer-manager-button-down",navigation:o.prefix+"-control-layer-manager-button-navigation",up:o.prefix+"-control-layer-manager-button-up"},this.explorer=t,this.icons={details:"olexp-control-layer-manager-details",down:"olexp-control-layer-manager-down",navigation:"olexp-control-layer-manager-navigation",up:"olexp-control-layer-manager-up"},this.manager=e,this.settings=i.control.LayerManager,this.manager.on("remove:item",this.onItemRemoved,this),this.manager.on("select:item",this.onItemSelected,this)};e.prototype.details=function(){this.explorer.navigation.toggle(this.explorer.options.details.type);var t=this.explorer.navigation.get(this.explorer.options.details.type);this.explorer.toolbar.get(this.buttons.details).hint=this.hintDetails(t.hidden),this.explorer.toolbar.refresh()},e.prototype.down=function(){this.manager.moveDown()},e.prototype.hintDetails=function(t){return t?this.settings.hintDetailsShow:this.settings.hintDetailsHide},e.prototype.hintNavigation=function(t){return t?this.settings.hintOutlineShow:this.settings.hintOutlineHide},e.prototype.navigation=function(){this.explorer.layout.toggle(this.explorer.options.navigation.type);var t=this.explorer.layout.get(this.explorer.options.navigation.type);this.explorer.toolbar.get(this.buttons.navigation).hint=this.hintNavigation(t.hidden),this.explorer.toolbar.refresh()},e.prototype.onItemRemoved=function(t){this.manager.isSelected(t.id)&&(this.explorer.toolbar.disable(this.buttons.up),this.explorer.toolbar.disable(this.buttons.down))},e.prototype.onItemSelected=function(t){if(void 0!==t){var e=this.manager.getById(t);if(null!==e)this.manager.getNode(e.id).disabled?(this.explorer.toolbar.disable(this.buttons.up),this.explorer.toolbar.disable(this.buttons.down)):(this.explorer.toolbar.enable(this.buttons.up),this.explorer.toolbar.enable(this.buttons.down))}},e.prototype.up=function(){this.manager.moveUp()},t.control.LayerManager=function(t,o,i){void 0===i&&(i={}),void 0===i.details&&(i.details={}),void 0===i.details.enabled&&(i.details.enabled=!0),void 0===i.details.checked&&(i.details.checked=!0),void 0===i.down&&(i.down=!0),void 0===i.navigation&&(i.navigation={}),void 0===i.navigation.enabled&&(i.navigation.enabled=!0),void 0===i.navigation.checked&&(i.navigation.checked=!0),void 0===i.up&&(i.up=!0);var n=new e(t,o,i.settings),r=[];return i.navigation.enabled&&r.push({checked:i.navigation.checked,hint:n.hintNavigation(!i.navigation.checked),id:n.buttons.navigation,img:n.icons.navigation,onClick:function(){n.navigation()},type:"check"}),i.details.enabled&&r.push({checked:i.details.checked,hint:n.hintDetails(!i.details.checked),id:n.buttons.details,img:n.icons.details,onClick:function(){n.details()},type:"check"}),i.up&&r.push({disabled:!0,hint:n.settings.hintMoveUp,id:n.buttons.up,img:n.icons.up,onClick:function(){n.up()},type:"button"}),i.down&&r.push({disabled:!0,hint:n.settings.hintMoveDown,id:n.buttons.down,img:n.icons.down,onClick:function(){n.down()},type:"button"}),r}}(s||{}),function(t){var e=function(t,e,o,i){var n=$.extend(!0,{control:{LayerMenu:{arrow:!0,hint:"Item Options",text:""}}},i);this.button=i.prefix+"-control-layer-menu",this.explorer=t,this.icon="olexp-control-layer-menu",this.manager=e,this.menu=o,this.settings=n.control.LayerMenu,this.manager.on("remove:item",this.onItemRemoved,this),this.manager.on("select:item",this.onItemSelected,this)};e.prototype.onItemRemoved=function(t){this.manager.isSelected(t.id)&&this.explorer.toolbar.disable(this.button)},e.prototype.onItemSelected=function(t){if(void 0!==t){var e=this.manager.getById(t);if(null!==e)this.manager.getNode(e.id).disabled?this.explorer.toolbar.disable(this.button):this.explorer.toolbar.enable(this.button)}},t.control.LayerMenu=function(t,o,i,n){var r=new e(t,o,i,n.settings);return t.toolbar.on("click",function(e){if(null!==t.outline.selected){var o=r.button+":";if(!(e.target.indexOf(o)<0)){var n=e.target.replace(o,"");void 0!==i.callbacks[n]&&i.callbacks[n]({target:t.outline.selected})}}}),{arrow:r.settings.arrow,disabled:!0,hint:r.settings.hint,id:r.button,img:r.icon,items:r.menu.items,text:r.settings.text,type:"menu"}}}(s||{}),function(t){var e=function(e,o){var i=$.extend(!0,{control:{Measurement:{hintArea:"Measure area",hintLength:"Measure length"}}},o);this.explorer=e,this.icons={area:"olexp-control-measure-area",length:"olexp-control-measure-length"},this.ids={area:o.prefix+"-control-measure-area-button",length:o.prefix+"-control-measure-length-button"},this.settings=i.control.Measurement,this.tool=new t.measure.Tool(e.map,{type:t.measure.Type.LINE,settings:o})};e.prototype.area=function(){var e=!this.explorer.toolbar.get(this.ids.area).checked;this.measure(t.measure.Type.AREA,e)},e.prototype.length=function(){var e=!this.explorer.toolbar.get(this.ids.length).checked;this.measure(t.measure.Type.LINE,e)},e.prototype.measure=function(t,e){this.tool.setEnable(!1),e&&(this.tool.setType(t),this.tool.setEnable(!0))},t.control.Measure=function(t,o){void 0===o&&(o={}),void 0===o.area&&(o.area=!0),void 0===o.length&&(o.length=!0),void 0===o.settings&&(o.settings={});var i=new e(t,o.settings),n=[];return o.area&&n.push({hint:i.settings.hintArea,id:i.ids.area,img:i.icons.area,onClick:function(){o.length&&t.toolbar.uncheck(i.ids.length),i.area()},type:"check"}),o.length&&n.push({hint:i.settings.hintLength,id:i.ids.length,img:i.icons.length,onClick:function(){o.area&&t.toolbar.uncheck(i.ids.area),i.length()},type:"check"}),n}}(s||{}),function(t){var e=function(e,o){var i=$.extend(!0,{control:{ToolbarHide:{hint:"Hide toolbar"}}},o.settings);this.button=o.settings.prefix+"-control-toolbar-hide-button",this.explorer=e,this.icon="olexp-control-toolbar-hide",this.settings=i.control.ToolbarHide,this.show=t.ol.ToolbarShow(this.explorer,o)};e.prototype.hide=function(){this.explorer.layout.hide(this.explorer.options.toolbar.type),this.show.setMap(this.explorer.map)},t.control.ToolbarHide=function(t,o){var i=new e(t,o);return{hint:i.settings.hint,id:i.button,img:i.icon,onClick:function(){i.hide()},type:"button"}}}(s||{});var a=s.control;const l={event:{}};!function(t){var e=function(t){this.listeners=$.extend({},t)};e.prototype.on=function(t,e,o){if(void 0!==this.listeners[t]){var i=e;void 0!==o&&(i=e.bind(o)),this.listeners[t].push(i)}},e.prototype.register=function(t){void 0===this.listeners[t]&&(this.listeners[t]=[])},e.prototype.trigger=function(){var t=Array.prototype.slice.call(arguments),e=t.shift();if(void 0!==this.listeners[e]){var o=this;this.listeners[e].forEach(function(e){e.apply(o,t)})}},e.prototype.unregister=function(t){if(void 0===this.listeners[t])return[];var e=this.listeners[t];return delete this.listeners[t],e},e.prototype.off=function(t,e,o){if(void 0!==this.listeners[t]){var i=e;void 0!==o&&(i=e.bind(o));var n=this.listeners[t].indexOf(i);n>-1&&this.listeners[t].splice(n,1)}},t.event.Event=function(t){return new e(t)}}(l||{});var p=l.event;const h={item:{},measure:e,util:r};!function(t){t.item.icons={group:"olexp-item-group",heatmap:"olexp-item-heatmap",image:"olexp-item-image",overlay:"olexp-item-overlay",tile:"olexp-item-tile",vector:"olexp-item-vector"};var e=function(t,o,i){this.id=t,this.layer=i,this.moving=!1,this.name=o,this.type=e.getType(this.layer),this.icon=e.getIcon(this.type)};e.prototype.getDetails=function(){var e={};e.Name=this.name;var o=this.layer.getProperties();if(o.hasOwnProperty(t.measure.properties.area)?e.Area=o[t.measure.properties.area]:o.hasOwnProperty(t.measure.properties.length)&&(e.Length=o[t.measure.properties.length]),this.type===t.item.Type.GROUP){var i=this.layer.getLayers();e["Layer Count"]=i.getLength()}if(this.type===t.item.Type.VECTOR){var n=this.layer.getSource().getFeatures();e["Feature Count"]=n.length}return t.util.toRecords(e)},e.prototype.getExtent=function(){if(this.type===t.item.Type.OVERLAY)return null;if(this.type===t.item.Type.GROUP){var o=null;return this.layer.getLayers().forEach(function(t){var i=e.getLayerExtent(t);null===o&&null!==i?o=i:null!==o&&null!==i&&(o=ol.extent.extend(o,i))},this),o}return e.getLayerExtent(this.layer)},e.getIcon=function(e){return e===t.item.Type.GROUP?t.item.icons.group:e===t.item.Type.HEATMAP?t.item.icons.heatmap:e===t.item.Type.IMAGE?t.item.icons.image:e===t.item.Type.OVERLAY?t.item.icons.overlay:e===t.item.Type.TILE?t.item.icons.tile:e===t.item.Type.VECTOR?t.item.icons.vector:"icon-page"},e.getLayerExtent=function(t){var e=t.getExtent();if(void 0===e){var o=t.getSource();null!==o&&(o instanceof ol.source.Cluster||o instanceof ol.source.VectorTile||o instanceof ol.source.Vector)&&(e=o.getExtent())}return void 0===e?null:e},e.prototype.getPropertyTypes=function(){return this.layer instanceof ol.layer.Layer?t.item.LayerProperties:this.layer instanceof ol.Overlay?t.item.OverlayProperties:{}},e.prototype.getProperties=function(){var t={name:this.name},e=this.getPropertyTypes(),o=this;return Object.keys(e).forEach(function(e){t[e]=o.layer.get(e)}),t},e.getType=function(e){return e instanceof ol.layer.Group?t.item.Type.GROUP:e instanceof ol.layer.Heatmap?t.item.Type.HEATMAP:e instanceof ol.layer.Image?t.item.Type.IMAGE:e instanceof ol.layer.Tile?t.item.Type.TILE:e instanceof ol.layer.Vector?t.item.Type.VECTOR:e instanceof ol.Overlay?t.item.Type.OVERLAY:null},e.prototype.setProperties=function(t){t.hasOwnProperty("name")&&(this.name=t.name);var e=this.getPropertyTypes(),o=this;Object.keys(e).forEach(function(e){t.hasOwnProperty(e)&&o.layer.set(e,t[e])})},e.prototype.property=function(t,e){if(void 0!==this[t])return void 0!==e&&(this[t]=e),this[t]},e.prototype.zoomTo=function(e){var o=e.getView();if(this.type===t.item.Type.OVERLAY){var i=this.layer.getPosition();if(void 0!==i)return void o.setCenter(i);w2alert("Overlay has no position defined to which to zoom.","Warning")}else{var n=this.getExtent();if(null!==n)return void o.fit(n,e.getSize());w2alert("Layer has no extent defined to which to zoom.","Warning")}},t.item.Item=function(t,o,i){var n=new e(t,o,i);return{getDetails:n.getDetails.bind(n),getProperties:n.getProperties.bind(n),getPropertyTypes:n.getPropertyTypes.bind(n),icon:n.icon,id:n.id,layer:n.layer,moving:function(t){return n.property("moving",t)},name:function(t){return n.property("name",t)},setProperties:n.setProperties.bind(n),type:n.type,zoomTo:n.zoomTo.bind(n)}},t.item.OverlayProperties={},t.item.LayerProperties={opacity:{title:"Opacity"}},t.item.Type={GROUP:0,HEATMAP:1,IMAGE:2,OVERLAY:3,TILE:4,VECTOR:5}}(h||{});const c={event:p,item:h.item,manager:{},measure:e,util:r};!function(t){var e=function(e,o,i,n,r){this.event=new t.event.Event({"select:item":[]}),this.managerLayers=new t.manager.NodeManager(n,e.getLayers(),o,i),this.layersId=n,this.managerOverlays=new t.manager.NodeManager(r,e.getOverlays(),o,i),this.map=e,this.map.on("change:layergroup",this.onLayerGroupChanged,this),this.outline=o,this.overlaysId=r};e.prototype.isIdLayerNode=function(t){return"string"==typeof t&&0===t.indexOf(this.layersId)},e.prototype.isIdOverlayNode=function(t){return"string"==typeof t&&0===t.indexOf(this.overlaysId)},e.prototype.isSelected=function(t){return t===this.outline.selected},e.prototype.getById=function(t){return this.isIdLayerNode(t)?this.managerLayers.getById(t):this.isIdOverlayNode(t)?this.managerOverlays.getById(t):null},e.prototype.getDetails=function(t){if(this.isIdLayerNode(t)){var e=this.managerLayers.getById(t);if(null!==e)return e.getDetails()}else if(this.isIdOverlayNode(t)){var o=this.managerOverlays.getById(t);if(null!==o)return o.getDetails()}return[]},e.prototype.getNode=function(t){return this.outline.get(t)},e.prototype.moveDown=function(t){return void 0===t&&(t=this.outline.selected),this.isIdLayerNode(t)?this.managerLayers.moveDown(t):!!this.isIdOverlayNode(t)&&this.managerOverlays.moveDown(t)},e.prototype.moveUp=function(t){return void 0===t&&(t=this.outline.selected),this.isIdLayerNode(t)?this.managerLayers.moveUp(t):!!this.isIdOverlayNode(t)&&this.managerOverlays.moveUp(t)},e.prototype.off=function(t,e,o){this.event.off(t,e,o),this.managerLayers.off(t,e,o),this.managerOverlays.off(t,e,o)},e.prototype.on=function(t,e,o){this.event.on(t,e,o),this.managerLayers.on(t,e,o),this.managerOverlays.on(t,e,o)},e.prototype.onItemSelected=function(t){this.event.trigger("select:item",t)},e.prototype.onLayerGroupChanged=function(t){this.managerLayers.setLayers(t.target.getLayers())},e.prototype.removeFromMap=function(t){return t.hasOwnProperty("id")?this.isIdLayerNode(t.id)?this.managerLayers.removeFromMap(t):this.isIdOverlayNode(t.id)?this.managerOverlays.removeFromMap(t):null:null},e.prototype.toggleNode=function(t){if("string"==typeof t){var e=this.outline.get(t).disabled;if(e?this.outline.enable(t):this.outline.disable(t),this.isIdLayerNode(t)){var o=this.managerLayers.getById(t);null!==o&&o.layer.setVisible(e)}else if(this.isIdOverlayNode(t)){var i=this.managerOverlays.getById(t);if(null!==i){var n=i.layer.getProperties();if(n.hasOwnProperty("element")){var r=$(n.element);e?r.show():r.hide()}}}}},e.prototype.updateItem=function(t,e){var o=this.getById(t);null!==o&&(o.setProperties(e),this.outline.get(t).text=o.name(),this.outline.refresh())},e.prototype.zoomTo=function(t){this.getById(t).zoomTo(this.map)},t.manager.Manager=function(t,o,i,n,r){var s=new e(t,o,i,n,r);return{getById:s.getById.bind(s),getDetails:s.getDetails.bind(s),getNode:s.getNode.bind(s),isSelected:s.isSelected.bind(s),moveDown:s.moveDown.bind(s),moveUp:s.moveUp.bind(s),off:s.off.bind(s),on:s.on.bind(s),onItemSelected:s.onItemSelected.bind(s),removeFromMap:s.removeFromMap.bind(s),toggleNode:s.toggleNode.bind(s),updateItem:s.updateItem.bind(s),zoomTo:s.zoomTo.bind(s)}}}(c||{}),function(t){var e=function(e,o,i,n){this.count=0,this.details=n,this.event=new t.event.Event({"remove:item":[]}),this.id=e,this.items=[],this.layers=o,this.layers.on("change:length",this.onLayerChanged,this),this.managers={},this.outline=i};e.prototype.addLayer=function(o){this.count+=1;var i=this.id+"-"+this.count,n="Item "+this.count,r=o.getProperties();r.hasOwnProperty("name")&&(n=r.name);var s=new t.item.Item(i,n,o);this.items.push(s);var a={id:s.id,img:s.icon,text:s.name()},l=this.outline.get(this.id).nodes;if(0===l.length?this.outline.add(this.id,[a]):this.outline.insert(this.id,l[0].id,[a]),s.type===t.item.Type.GROUP){var p=o.getLayers(),h=new e(s.id,p,this.outline,this.details);p.forEach(function(t){h.addLayer(t)},this),this.managers[s.id]=h,this.outline.expand(s.id)}return s},e.prototype.getById=function(e,o){void 0===o&&(o=!0);var i=this,n=null;return this.items.forEach(function(r){if(null===n)if(r.id!==e){if(r.type===t.item.Type.GROUP&&o){var s=i.managers[r.id].getById(e);if(null!==s&&s.id===e)return void(n=s)}}else n=r}),n},e.prototype.getByLayer=function(e,o){void 0===o&&(o=!0);var i=this,n=null;return this.items.forEach(function(r){if(null===n)if(r.layer!==e){if(r.type===t.item.Type.GROUP&&o){var s=i.managers[r.id].getByLayer(e);if(null!==s&&s.layer===e)return void(n=s)}}else n=r}),n},e.prototype.getSize=function(){return this.items.length},e.prototype.isSelected=function(t){return t===this.outline.selected},e.prototype.isHidden=function(e){return e instanceof t.measure.Overlay},e.prototype.moveDown=function(e){var o=this.getById(e,!1);if(null!==o){var i=this.moveLayerUp(this.layers,o.layer);return i&&(i=this.moveItemDown(e)),i}var n=this,r=null;return this.items.forEach(function(o){if(null===r&&o.type===t.item.Type.GROUP){var i=n.managers[o.id].moveDown(e);if(null!==i)return void(r=i)}}),r},e.prototype.moveItemDown=function(t){var e=this.outline.get(t);if(null===e)return!1;var o=this.outline.find(e.parent.id,{parent:e.parent}),i=this.outline.get(e.parent.id,t,!0);if(i>=o.length-1)return!1;var n=o[i+1].id,r=o[i+1];return e.parent===r.parent&&(this.outline.remove(n),this.outline.insert(e.parent,t,r),this.outline.select(t),!0)},e.prototype.moveItemUp=function(t){var e=this.outline.get(t);if(null===e)return!1;var o=this.outline.find(e.parent.id,{parent:e.parent}),i=this.outline.get(e.parent.id,t,!0);if(i<=0)return!1;var n=o[i-1].id,r=o[i-1];return e.parent===r.parent&&(this.outline.remove(t),this.outline.insert(e.parent,n,e),this.outline.select(t),!0)},e.prototype.moveLayerDown=function(e,o){var i=t.util.indexOf(e,o);if(i<this.layers.getLength()-1){var n=this.getByLayer(o,!1);return n.moving(!0),e.removeAt(i),e.insertAt(i+1,o),n.moving(!1),!0}return!1},e.prototype.moveLayerUp=function(e,o){var i=t.util.indexOf(e,o);if(i>0){var n=this.getByLayer(o,!1);return n.moving(!0),e.removeAt(i),e.insertAt(i-1,o),n.moving(!1),!0}return!1},e.prototype.moveUp=function(e){var o=this.getById(e,!1);if(null!==o){var i=this.moveLayerDown(this.layers,o.layer);return i&&(i=this.moveItemUp(e)),i}var n=this,r=null;return this.items.forEach(function(o){if(null===r&&o.type===t.item.Type.GROUP){var i=n.managers[o.id].moveUp(e);if(null!==i)return void(r=i)}}),r},e.prototype.off=function(e,o,i){this.event.off(e,o,i);var n=this.getSize(),r=0;for(r=0;r<n;r+=1)this.items[r].type===t.item.Type.GROUP&&this.managers[this.items[r].id].off(e,o,i)},e.prototype.on=function(e,o,i){this.event.on(e,o,i);var n=this.getSize(),r=0;for(r=0;r<n;r+=1)this.items[r].type===t.item.Type.GROUP&&this.managers[this.items[r].id].on(e,o,i)},e.prototype.onItemRemoved=function(t){this.event.trigger("remove:item",t),this.isSelected(t.id)&&this.details.clear(),this.remove(t)},e.prototype.onLayerChanged=function(e){var o=e.target,i=0,n=null,r=o.getLength();for(i=0;i<r;i+=1)n=o.item(i),!1===this.isHidden(n)&&null===this.getByLayer(n)&&this.addLayer(n);var s=this;this.toList().forEach(function(e){!1===e.moving()&&-1===t.util.indexOf(s.layers,e.layer)&&s.onItemRemoved(e)})},e.prototype.remove=function(e){var o=this.items.indexOf(e);if(-1!==o)return this.items.splice(o,1),this.outline.remove(e.id),!0;var i=this,n=!1;return this.items.forEach(function(o){n||o.type===t.item.Type.GROUP&&i.managers[o.id].remove(e)&&(n=!0)}),n},e.prototype.removeFromMap=function(e){var o=this.layers.remove(e.layer);if(void 0!==o)return o;var i=this,n=null;return this.items.forEach(function(o){if(null===n&&o.type===t.item.Type.GROUP){var r=i.managers[o.id].removeFromMap(e);if(null!==r)return void(n=r)}}),n},e.prototype.setLayers=function(t){for(this.layers.un("change:length",this.onLayerChanged,this);this.items.length>0;)this.onItemRemoved(this.items[this.items.length-1]);this.layers=t,this.layers.on("change:length",this.onLayerChanged,this);var e=0;for(e=0;e<this.layers.getLength();e+=1)this.addLayer(this.layers.item(e))},e.prototype.toList=function(){var t=[],e=this.getSize(),o=0;for(o=0;o<e;o+=1)t.push(this.items[o]);return t},t.manager.NodeManager=function(t,o,i,n){var r=new e(t,o,i,n);return{getById:r.getById.bind(r),getByLayer:r.getByLayer.bind(r),moveDown:r.moveDown.bind(r),moveUp:r.moveUp.bind(r),off:r.off.bind(r),on:r.on.bind(r),removeFromMap:r.removeFromMap.bind(r),setLayers:r.setLayers.bind(r)}}}(c||{});var u=c.manager;const d={menu:{},util:r};!function(t){var e=function(t,e){var o=$.extend(!0,{menu:{Properties:{field:35,form:{},popup:{height:130,style:"width: 100%; height: 100%;",title:"Edit Layer",width:365},span:4,text:"Properties"}}},e);this.icon="olexp-menu-properties",this.form=e.prefix+"-menu-properties-form",this.id=e.prefix+"-menu-properties",this.manager=t,this.name="layerform",this.settings=o.menu.Properties};e.prototype.onClick=function(e){var o=this,i=e.target,n=this.manager.getById(i),r=n.getProperties(),s=this.settings.popup.height,a=this.settings.field,l=[];s+=a,l.push({field:"name",html:{caption:"Name",span:this.settings.span},required:!0,type:"text"});var p=n.getPropertyTypes();$.map(p,function(t){return t.title}).forEach(function(t){s+=a,l.push({field:t.toLowerCase(),html:{caption:t,span:o.settings.span},required:!0,type:"float"})});var h=$.extend(this.settings.form,{fields:l,name:this.name,record:r}),c=$.extend($.extend({},this.settings.popup),{height:s});t.util.popup(this.form,function(t){o.manager.updateItem(i,t)},h,c)},t.menu.Properties=function(t,o){var i=new e(t,o);return{menu:{id:i.id,img:i.icon,text:i.settings.text},click:function(t){i.onClick(t)}}}}(d||{}),function(t){var e=function(t,e){var o=$.extend(!0,{menu:{Remove:{text:"Remove"}}},e);this.icon="olexp-menu-remove",this.id=e.prefix+"-menu-remove",this.manager=t,this.settings=o.menu.Remove};e.prototype.onClick=function(t){var e=this,o=t.target,i=this.manager.getById(o);w2confirm('Do you want to delete "'+i.name()+'"?').yes(function(){e.manager.removeFromMap(i)})},t.menu.Remove=function(t,o){var i=new e(t,o);return{menu:{id:i.id,img:i.icon,text:i.settings.text},click:function(t){i.onClick(t)}}}}(d||{}),function(t){var e=function(t,e){var o=$.extend(!0,{menu:{Zoom:{text:"Zoom"}}},e);this.icon="olexp-menu-zoom",this.id=e.prefix+"-menu-zoom",this.manager=t,this.settings=o.menu.Zoom};e.prototype.onClick=function(t){var e=t.target;this.manager.zoomTo(e)},t.menu.Zoom=function(t,o){var i=new e(t,o);return{menu:{id:i.id,img:i.icon,text:i.settings.text},click:function(t){i.onClick(t)}}}}(d||{});var m=d.menu;const g={selection:{},util:r};!function(t){var e=function(e,o){this.details=o,this.interaction=new ol.interaction.Select,this.map=e;var i=this;this.interaction.on("select",function(e){if(1===e.selected.length){var o=e.selected[0],n=t.util.toProperties(o);Object.keys(n).forEach(function(t){var e=typeof n[t];"boolean"!==e&&"number"!==e&&"string"!==e&&delete n[t]});var r=t.util.toRecords(n);i.details.clear(),i.details.add(r)}})};e.prototype.setEnable=function(t){t?this.map.addInteraction(this.interaction):this.map.removeInteraction(this.interaction)},t.selection.Feature=function(t,o){var i=new e(t,o);return{setEnable:function(t){i.setEnable(t)}}}}(g||{});const y={control:a,manager:u,menu:m,selection:g.selection,util:r};return function(t){var e=function(e,o){if(void 0===e)throw new Error("olexp.Explorer: id not defined");if(0===$("#"+e).length)throw new Error("olexp.Explorer: id not found");var i="olexp-"+e;this.options={controls:{editsettings:!0,exportmap:!0,graticule:!0,layercontrol:!0,layermanager:!0,layermenu:!0,measure:!0,toolbarhide:!0},details:{hidden:!0,resizable:!0,size:"25%",type:"preview"},layers:{expanded:!0,group:!0,img:"icon-folder",text:"Layers"},map:{type:"main"},navigation:{resizable:!0,size:"15%",type:"left"},olcontrols:{fullscreen:!0,mouseposition:!0,overviewmap:!0,rotate:!0,scaleline:!0,zoom:!0,zoomslider:!0,zoomtoextent:!0},olinteractions:{draganddrop:!0},olmap:{controls:[],view:new ol.View({center:[0,0],zoom:3})},outline:{type:"main"},overlays:{expanded:!0,group:!0,img:"icon-folder",text:"Overlays"},settings:{},toolbar:{size:"40",style:"padding: 5px;",type:"top"}},$.extend(!0,this.options,o),$.extend(!0,this.options,{explorer:{cls:"olexp-explorer-content",id:i+"-explorer-id-content",details:i+"-explorer-name-details",layout:i+"-explorer-name-layout",navigation:i+"-explorer-name-navigation",outline:i+"-explorer-name-outline",toolbar:i+"-explorer-name-toolbar"},layers:{id:i+"-explorer-id-layers"},map:{content:'<div id="'+i+'-explorer-id-map" class="olexp-explorer-map"></div>'},olmap:{target:i+"-explorer-id-map"},overlays:{id:i+"-explorer-id-overlays"},settings:{prefix:i}});var n=this,r=$("<div>",{id:this.options.explorer.id,class:this.options.explorer.cls});$("#"+e).append(r),this.layout=$("#"+this.options.explorer.id).w2layout({name:this.options.explorer.layout,panels:[this.options.navigation,this.options.map,this.options.toolbar]}),this.toolbar=$("").w2toolbar({name:this.options.explorer.toolbar}),this.navigation=$("").w2layout({name:this.options.explorer.navigation,onResize:function(){n.hasOwnProperty("map")&&n.map.updateSize(),n.hasOwnProperty("details")&&n.details.resize()},panels:[this.options.outline,this.options.details]}),this.outline=$("").w2sidebar({name:this.options.explorer.outline,nodes:[this.options.layers,this.options.overlays],onClick:function(t){var e=t.target,o=n.manager.getDetails(e);n.details.clear(),n.details.add(o),n.manager.onItemSelected(e)},onDblClick:function(t){var e=t.target;n.manager.toggleNode(e),n.manager.onItemSelected(e)},onRender:function(t){t.onComplete=function(){var t=n.outline.selected;n.manager.onItemSelected(t)}}}),this.details=$("").w2grid({columns:[{field:"property",caption:"Property",size:"100%",sortable:!0},{field:"value",caption:"Value",size:"100%",sortable:!0}],name:this.options.explorer.details}),this.navigation.content(this.options.outline.type,this.outline),this.navigation.content(this.options.details.type,this.details),this.layout.content(this.options.navigation.type,this.navigation),this.map=new ol.Map(this.options.olmap),console.log("olexp = ",t),this.manager=new t.manager.Manager(this.map,this.outline,this.details,this.options.layers.id,this.options.overlays.id);var s=t.menu.Zoom(this.manager,this.options.settings),a=t.menu.Properties(this.manager,this.options.settings),l=t.menu.Remove(this.manager,this.options.settings);this.menu={items:[],callbacks:{}},this.menu.items.push(s.menu),this.menu.items.push(a.menu),this.menu.items.push(l.menu),this.menu.callbacks[s.menu.id]=s.click,this.menu.callbacks[a.menu.id]=a.click,this.menu.callbacks[l.menu.id]=l.click,this.outline.menu=this.menu.items,this.outline.onMenuClick=function(t){var e=t.menuItem.id;void 0!==n.menu.callbacks[e]&&n.menu.callbacks[e](t)},this.util=new t.util.Util(this.options.settings);var p=this.util.getInteractions(this.map);Object.keys(this.options.olinteractions).forEach(function(t){var e=p[t];n.options.olinteractions[t]&&n.map.addInteraction(e)});var h=this.util.getControls();Object.keys(this.options.olcontrols).forEach(function(t){var e=h[t];n.map.addControl(e),e.setMap(n.options.olcontrols[t]?n.map:null)}),this.selector=new t.selection.Feature(this.map,this.details),this.selector.setEnable(!0),this.api={details:this.details,layout:this.layout,manager:this.manager,map:this.map,navigation:this.navigation,options:this.options,outline:this.outline,toolbar:this.toolbar},this.options.controls.toolbarhide&&(this.toolbar.add(t.control.ToolbarHide(this.api,{hidden:this.options.toolbar.hidden,settings:this.options.settings})),this.toolbar.add({id:"break-toolbar-hide",type:"break"})),this.options.controls.layermanager&&(this.toolbar.add(t.control.LayerManager(this.api,this.manager,{details:{checked:!this.options.details.hidden},navigation:{checked:!this.options.navigation.hidden},settings:this.options.settings})),this.toolbar.add({id:"break-layer-manager",type:"break"})),this.options.controls.layermenu&&(this.toolbar.add(t.control.LayerMenu(this.api,this.manager,this.menu,{settings:this.options.settings})),this.toolbar.add({id:"break-item-menu",type:"break"})),this.options.controls.layercontrol&&(this.toolbar.add(t.control.LayerControl(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-layer-control",type:"break"})),this.options.controls.graticule&&(this.toolbar.add(t.control.Graticule(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-graticule",type:"break"})),this.options.controls.measure&&(this.toolbar.add(t.control.Measure(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-measure",type:"break"})),this.options.controls.exportmap&&(this.toolbar.add(t.control.ExportMap(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-export-map",type:"break"})),this.options.controls.editsettings&&(this.toolbar.add(t.control.EditSettings(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-edit-settings",type:"break"})),this.layout.set(this.options.toolbar.type,{content:"",show:{toolbar:!0},toolbar:this.toolbar})};t.destroy=function(t){void 0!==t.map&&t.map.setTarget(null),void 0!==t.details&&t.details.destroy(),void 0!==t.outline&&t.outline.destroy(),void 0!==t.navigation&&t.navigation.destroy(),void 0!==t.toolbar&&t.toolbar.destroy(),void 0!==t.layout&&t.layout.destroy()},t.Explorer=function(t,o){return new e(t,o).api}}(y||{}),{destroy:y.destroy,Explorer:y.Explorer}});
